2023年7月24日，AMD发布了一份安全公告，披露了其Zen2计算机处理器微架构中的一个漏洞。该漏洞被AMD命名为“跨进程信息泄露”，也被称为“Zenbleed”。该漏洞被标记为CVE-2023-20593，并被AMD评为中等严重程度。此问题允许攻击者在特定情况下访问CPU处理的敏感信息。所有运行在基于AMD Zen2处理器上的软件，包括虚拟机、沙箱、容器和进程，都会受到影响。利用此漏洞的软件可能已经存在，预计基于此漏洞的攻击很快就会发生。
所有AMD Zen2 CPU，包括EPYC Rome处理器，都存在此漏洞，具体包括：
- AMD Ryzen 3000系列处理器
- AMD Ryzen PRO 3000系列处理器
- AMD Ryzen Threadripper 3000系列处理器
- 带有Radeon显卡的AMD Ryzen 4000系列处理器
- 带有Radeon显卡的AMD Ryzen PRO 4000系列处理器
- 带有Radeon显卡的AMD Ryzen 5000系列处理器
- 带有Radeon显卡的AMD Ryzen 7020系列处理器
- 第二代AMD EPYC “Rome”处理器
OVHcloud产品的影响
针对这一事件，我们立即审查了安全公告和技术信息，并确定了以下对我们产品可能产生的影响。
- 公共云：所有产品未受影响
- 托管私有云：所有产品未受影响
- 网站托管与域名：所有产品未受影响
- 裸机云：ADVANCE-1, Advance STOR-1, Advance STOR-2, Game-1, Game-2, HGR-SDS-2, HGR-HCI-4, HGR-HCI-5, HGR-HCI-6, Infra-2, Rise-GAME-1, Rise-GAME-2, Scale-1, Scale-2, Scale-3（仅限由AMD Zen2驱动的服务器）可能受影响
- 其他商用系列专用服务器：未受影响
如何缓解漏洞：
- 客户自行缓解：通过固件包更新在启动时加载修补的微代码。此解决方案将通过操作系统更新（例如linux-firmware包）触发处理器微代码的更新。您可以在您的操作系统编辑器或社区分发更新包后进行操作。此方法取决于您的发行版或操作系统编辑器，并且只有在AMD提供了适当的微代码时才有效。目前，只有“Zen2 Rome”和“Zen2 Castle Peak”可以通过此方法覆盖。
- 使用更新的内核缓解：当无法通过固件更新包获得微代码更新时，您可以更新内核版本，通过配置所谓的“chicken bit”来禁用故障处理器功能以实现缓解。这可能会影响系统的性能。此解决方案将在操作系统编辑器回传新版本的Linux内核时包含。我们建议客户优先采用此缓解策略，因为这是最有效的，不依赖于硬件供应商是否提供更新的微代码。
- 作为替代方案，您可以手动设置chicken bit而不依赖内核更新。然而，我们不推荐这种可能对系统有风险的解决方案。
OVHcloud发起的缓解措施
OVHcloud团队正在努力实施透明的解决方案，确保客户的修补微代码以透明的方式更新。这些解决方案将逐步部署到我们的服务器上。目前正在评估两个主要选项。
- 使用OVHcloud iPXE：当客户使用标准的OVHcloud网络启动（最常见的配置）时，引导加载程序可能会加载微代码更新。一旦可用，通过OVHcloud客户界面重启服务器将导致在从磁盘启动之前加载更新的微代码，从而缓解漏洞。但是，如果您不使用OVHcloud网络启动系统直接从磁盘启动，则不会应用缓解措施，您应该考虑依赖操作系统级别的缓解措施。
- 使用UEFI：UEFI固件更新可能在启动时更新CPU微代码。包括修补微代码的UEFI固件更新可能会在未来几个月内由主板制造商提供。一旦可用，OVHcloud将在任何新交付的服务器上包含此修补微代码。客户随后可以通过联系支持请求UEFI固件更新。
作为潜在受影响服务器的管理员，我该怎么办？
首先，使用我们团队开发的工具（仅限Linux）检查您的服务器是否受到此漏洞的影响：
# wget https://raw.githubusercontent.com/speed47/spectre-meltdown-checker/master/spectre-meltdown-checker.sh
# sh spectre-meltdown-checker.sh --variant zenbleed --explain
如果工具显示“NOT VULNERABLE”（未受影响），则您已经安全，无需进一步行动。
如果工具显示“VULNERABLE”（受影响），则应评估您面临威胁的程度。
供应商表示：“不幸的是，Kaseya的VSA产品已成为一次复杂的网络攻击的受害者。”据信与俄罗斯威胁组织“REvil”有关的黑客利用SQL漏洞和身份验证绕过手段劫持了Kaseya VSA的本地部署。这导致众多企业和托管服务提供商客户的未知数量的笔记本电脑、台式机和服务器上的文件被加密勒索。从这次代价高昂（对某些人来说是灾难性的）的网络事件中，我们再次得到了一个宝贵的教训：从外部获取数据的应用程序有可能被对手劫持。所有企业的IT/Sec-Ops人员必须对这些高风险应用程序应用遏制控制措施，以防止此类攻击得逞。
关于本地Kaseya VSA你需要知道，它是一种IT远程监控和管理（RMM）解决方案，用于由IT和网络管理员在企业计算设备上安装和修补软件、管理备份、自动化其他IT流程以及远程解决和排除IT问题。这类工具需要在每个计算设备上运行具有提升权限的软件代理。在这次攻击中，各个计算设备上的单独代理没有被利用，而是两台或更多服务器上运行的VSA软件遭到破坏，然后指示代理安装并运行恶意软件。
Kaseya SaaS未被攻破，它像Kaseya VSA一样，依赖于每个计算设备上运行的代理。然而，Kaseya SaaS代理由Kaseya的云指导，似乎这些客户没有受到这次攻击的影响。
高管们应该了解如何减轻此类网络攻击的风险。当你阅读和听取关于这次攻击的细节时，你会听到关于SQL注入和身份验证绕过的信息。这些只是导致不幸结果的手段。无论哪种方式，对手都会劫持你基础设施中的关键应用程序，并用它来对付你。有一类安全控制措施，每个企业都应该全面使用：遏制和隔离。遏制限制了高风险应用程序对其所驻留的端点的其余部分可以做什么。隔离限制了端点的其余部分对同一主机上的应用程序或对象可以做什么或从中获取什么。
在这次攻击中，当被劫持的Kaseya VSA应用程序试图写入不应写入的地方时，遏制控制会实时阻止这些操作。在这次攻击中，一个零日漏洞被利用来劫持Kaseya VSA应用程序。或者，在这次攻击中没有发生的情况是，另一个应用程序可能已被破坏并用于向Kaseya VSA应用程序注入恶意代码。隔离控制可以阻止这种技术。
还有另一种方法可以实现相同的保护效果：一种执行预执行和执行期间功能的应用程序控制工具。“peri-”意味着它在操作期间对Kaseya VSA等应用程序强制执行某些读写规则。不幸的是，对于大多数能够执行此功能的网络工具而言，规则集可能非常复杂且难以创建和维护，因为这些细粒度的规则必须随着应用程序随时间的变化而变化。很少有企业（不到5%，甚至可能不到1%）实施执行期间的应用程序控制工具，因为它们给日常运营带来了负担。
AppGuard本可以保护受害者免受其被劫持的Kaseya VSA软件的侵害。AppGuard破解了在添加强大保护的同时避免执行期间应用程序控制困难的代码。没有哪个供应商能像AppGuard那样使遏制和隔离安全控制措施如此易于实施和维护，或如此有效。正如SolarWinds供应链攻击、Microsoft Exchange Server Proxylogon攻击以及过去一年中许多其他重大头条恶意软件攻击一样，AppGuard被发现是区分受害者和胜利者的关键。
AppGuard的方法可能与你熟悉的方法大不相同，它通过阻止不允许的操作来中和攻击，而无需识别恶意软件，并通过自动适应活动上下文的控制来避免过去技术的缺陷。这与为你或其他人部署的大多数东西形成对比，后者只有在识别出恶意内容时才能成功防御攻击（并且更麻烦的是，如果识别出的话）。
今天的对手非常擅长伪装他们的攻击，通常看起来像是无害的日常活动。Kaseya聘请调查此事件的Mandiant公司此前报告称，在他们2020年进行的65%的调查中，IT/SecOps团队在一周内未能发现攻击。这给攻击者留下了太多时间潜伏在企业内部，有时甚至是在光天化日之下隐藏。如果你要保护银行或军事基地，请将AppGuard视为你的锁和安全许可，而基于检测的工具如EDR或NGAV则是你的安全摄像头和保安。即使间谍可以欺骗你的保安，他们也需要合法的许可才能进入金库。
AppGuard可以添加到任何现有的网络基础设施中，显著提高对逃避基于检测工具的恶意软件攻击的保护，例如这次Kaseya攻击。它轻量级、易于操作，并在端点上实现实时阻止恶意软件攻击，从而减少警报、横向移动、端点修复，甚至减轻应用程序补丁管理的压力。
了解更多关于AppGuard如何帮助你的信息。
According to the National Information Security Vulnerability Database (CNNVD) statistics, from May 8-14, 2023, CNNVD received reports of 311 vulnerabilities, including 175 information technology product vulnerabilities and 136 network information system vulnerabilities. Additionally, CNNVD collected 102 vulnerability notifications.
The key vulnerabilities to focus on this week include: CVE-2023-31039 Apache bRPC Code Execution Vulnerability, CVE-2023-20877 VMware Aria Operations Privilege Escalation Vulnerability, the May 2023 Patch Tuesday with multiple Microsoft vulnerabilities, and CVE-2023-29032 Apache OpenMeetings Authentication Bypass Vulnerability. These vulnerabilities have a broad impact, and Hua Yun An recommends that relevant users conduct asset self-inspections and take preventive measures.
**01 CVE-2023-31039 Apache bRPC Code Execution Vulnerability**
Threat Level: High
Vulnerability Description:
On May 8, 2023, the Hua Yun An Si Jing security team monitored that Apache officially released a security update, disclosing a vulnerability in versions of Apache bRPC prior to 1.5.0. Apache bRPC is an open-source, industrial-grade C++ RPC framework, commonly used in high-performance systems such as search, storage, machine learning, advertising, and recommendations. An unauthenticated attacker could exploit this vulnerability to modify the ServerOptions pid_file parameter when the bRPC server starts, leading to arbitrary code execution with bRPC process permissions.
Source:
https://lists.apache.org/thread/jqpttrqbc38yhckgp67xk399hqxnz7jn