2023年7月24日，AMD发布了一份安全公告，披露了其Zen2计算机处理器微架构中的一个漏洞。该漏洞被AMD命名为“跨进程信息泄露”，也被称为“Zenbleed”。该漏洞被标记为CVE-2023-20593，并被AMD评为中等严重程度。此问题允许攻击者在特定情况下访问CPU处理的敏感信息。所有运行在基于AMD Zen2处理器上的软件，包括虚拟机、沙箱、容器和进程，都会受到影响。利用此漏洞的软件可能已经存在，预计基于此漏洞的攻击很快就会发生。

所有AMD Zen2 CPU，包括EPYC Rome处理器，都存在此漏洞，具体包括：
- AMD Ryzen 3000系列处理器
- AMD Ryzen PRO 3000系列处理器
- AMD Ryzen Threadripper 3000系列处理器
- 带有Radeon显卡的AMD Ryzen 4000系列处理器
- 带有Radeon显卡的AMD Ryzen PRO 4000系列处理器
- 带有Radeon显卡的AMD Ryzen 5000系列处理器
- 带有Radeon显卡的AMD Ryzen 7020系列处理器
- 第二代AMD EPYC “Rome”处理器

对OVHcloud产品的影响
针对这一事件，我们立即审查了安全公告和技术信息，并确定了以下对我们产品可能产生的影响。
- 公共云：所有产品未受影响
- 托管私有云：所有产品未受影响
- 网站托管与域名：所有产品未受影响
- 裸机云：ADVANCE-1, Advance STOR-1, Advance STOR-2, Game-1, Game-2, HGR-SDS-2, HGR-HCI-4, HGR-HCI-5, HGR-HCI-6, Infra-2, Rise-GAME-1, Rise-GAME-2, Scale-1, Scale-2, Scale-3（仅限由AMD Zen2驱动的服务器）可能受影响
- 其他商用系列专用服务器：未受影响

如何缓解漏洞：
- 客户自行缓解：通过固件包更新在启动时加载修补的微代码。此解决方案将通过操作系统更新（例如linux-firmware包）触发处理器微代码的更新。您可以在您的操作系统编辑器或社区分发更新包后进行操作。此方法取决于您的发行版或操作系统编辑器，并且只有在AMD提供了适当的微代码时才有效。目前，只有“Zen2 Rome”和“Zen2 Castle Peak”可以通过此方法覆盖。
- 使用更新的内核缓解：当无法通过固件更新包获得微代码更新时，您可以更新内核版本，通过配置所谓的“chicken bit”来禁用故障处理器功能以实现缓解。这可能会影响系统的性能。此解决方案将在操作系统编辑器回传新版本的Linux内核时包含。我们建议客户优先采用此缓解策略，因为这是最有效的，不依赖于硬件供应商是否提供更新的微代码。
- 作为替代方案，您可以手动设置chicken bit而不依赖内核更新。然而，我们不推荐这种可能对系统有风险的解决方案。

OVHcloud发起的缓解措施
OVHcloud团队正在努力实施透明的解决方案，确保客户的修补微代码以透明的方式更新。这些解决方案将逐步部署到我们的服务器上。目前正在评估两个主要选项。
- 使用OVHcloud iPXE：当客户使用标准的OVHcloud网络启动（最常见的配置）时，引导加载程序可能会加载微代码更新。一旦可用，通过OVHcloud客户界面重启服务器将导致在从磁盘启动之前加载更新的微代码，从而缓解漏洞。但是，如果您不使用OVHcloud网络启动系统直接从磁盘启动，则不会应用缓解措施，您应该考虑依赖操作系统级别的缓解措施。
- 使用UEFI：UEFI固件更新可能在启动时更新CPU微代码。包括修补微代码的UEFI固件更新可能会在未来几个月内由主板制造商提供。一旦可用，OVHcloud将在任何新交付的服务器上包含此修补微代码。客户随后可以通过联系支持请求UEFI固件更新。

作为潜在受影响服务器的管理员，我该怎么办？
首先，使用我们团队开发的工具（仅限Linux）检查您的服务器是否受到此漏洞的影响：
# wget https://raw.githubusercontent.com/speed47/spectre-meltdown-checker/master/spectre-meltdown-checker.sh
# sh spectre-meltdown-checker.sh --variant zenbleed --explain
如果工具显示“NOT VULNERABLE”（未受影响），则您已经安全，无需进一步行动。
如果工具显示“VULNERABLE”（受影响），则应评估您面临威胁的程度。
裸金属服务器、数据保护与隐私：来自Intel的Mike Ferron-Jones合作撰写。面对严峻的网络威胁环境，企业正在寻找新的数据保护和隐私解决方案及最佳实践。OVHcloud的新款Advance-6裸金属服务器配备了第三代Intel® Xeon®可扩展处理器（以前代号为“Ice Lake”）和Intel®软件保护扩展（Intel SGX）。这些技术提供了更高的性能，并利用机密计算来实现数据隐私、法规遵从性和更强的数据保护。阅读本文以了解更多关于机密计算的信息以及如何从中受益。

现代业务转型的核心在于数据处理能力的提升。随着世界变得更加互联，企业面临数据收集、使用和存储的增长。为了应对这一挑战，云和数据分析等新解决方案不断涌现，正在改变业务运营方式。然而，如果忽视安全问题，这些变化也可能带来更大的风险。我们认为，安全、隐私和合规性必须与业务转型并行推进。因此，我们使用Intel® SGX构建了Advance-6裸金属服务器——它为客户提供了机密计算和增强的数据保护。虽然磁盘和网络加密可以在数据存储或传输时提供保护，但传统上，在数据被CPU和内存使用时是脆弱的。Intel SGX创建了硬件保护的“飞地”，旨在在数据使用时屏蔽数据和代码免受未经授权的方或软件的侵害。飞地内的数据和代码对云管理员或软件堆栈不可访问，从而帮助组织遵守GDPR和其他法规的要求。

通过机密计算应对安全挑战变得尤为重要。企业数据正面临黑客、未经授权的第三方和恶意内部人员的更大威胁，他们经常利用应用程序中的漏洞，或操作系统和虚拟机监控程序层中的特权提升。随着软件安全性的提高，攻击者开始向下移动到堆栈中寻找新的漏洞，这使得商业机密或受监管的数据面临风险。数据泄露可能导致严重的经济损失和声誉损害。这意味着外围防御已不再足够。需要的是多层次的防御策略，使成功执行攻击变得不可行。机密计算技术对于此类策略至关重要，因为它使用基于硬件的方法将数据隔离在可信飞地中并在内存中对其进行加密。这可以保护数据免受操作系统和虚拟机监控程序层中的漏洞的影响，并确保即使具有完全访问权限的用户也无法在没有密钥的情况下解密数据。

机密计算也是“合规计算”。欧洲在隐私和数据保护方面处于世界领先地位，处理个人或受监管数据的组织需要采取措施来最小化违规或违反的风险。这意味着部署行业最佳实践和最新的隐私保护技术，以维护数据安全、主权和控制。使用Intel SGX的机密计算可以成为合规制度的关键部分，并有助于降低监管风险。即使是像OVHcloud这样的云提供商也无法访问飞地内受保护的数据。此外，OVHcloud提供认证服务，使客户能够获得加密验证，确认其工作负载运行在真正的Intel SGX硬件上，微代码是最新的，软件负载正是预期的。认证有助于确保客户的数据受到保护并符合规定。

Advance-6裸金属服务器提供了增强的性能，同时使解决方案能够快速大规模部署。它受益于PCIe Gen4和数据中心级NVMe磁盘，从而提高了带宽。OVHcloud链路聚合功能使两台服务器的物理网络链接能够聚合，以实现最佳网络速度。Advance-6服务器还包含第三代Intel® Xeon®可扩展处理器，该处理器通过Intel® 10nm工艺提高了每核性能。它们还包含驱动机密计算的技术——Intel® SGX。Intel® SGX在CPU级别内置，使数据能够在可信的加密飞地中隔离。Intel® SGX还提供：即使操作系统/驱动程序/BIOS/VMM/SMM被破坏，也能防止攻击；即使攻击者完全控制平台，也能增加对秘密（数据/密钥/密码）的保护；防御针对内存总线窥探、内存篡改和针对RAM的“冷启动”攻击。

以下是一些机器学习和密码学中的示例：
安全多方计算
组织经常需要协作，但由于保密或法规原因，共享数据是被禁止的。安全多方计算是一种隐私保护技术，使多方能够汇集他们的数据并产生更准确的结果，同时保持每个方的数据对其他方的私密性。各方都可以使用认证功能来验证其“数据洁净室”是否正常运行并且软件是他们所期望的。Intel SGX今天用于多党医疗研究和金融欺诈检测用例。
联邦学习
联邦学习是一种隐私保护机器学习（PPML）方法，它将算法部署到分散的设备或站点，以便从太大或太敏感而无法移动到公共数据洁净室的数据中创建联合分析。在这种用例中，算法在进行分析时受到Intel SGX飞地的保护。去除任何私人信息后，结果会传递到中央节点，与其他节点的结果结合，并将新的权重或参数推送到远程模型。这确保敏感数据不会暴露于威胁，并帮助组织构建更准确的模型。
只能应用一些零信任原则来限制被隔离应用程序在多个维度（如文件、注册表、内存、子进程、权限和网络）上的读写操作。微软的应用程序防护是唯一具备此功能的端点保护平台（EPP）产品，并免费提供给所有Windows企业许可证持有者，但使用率不到1%。企业也可以从其他供应商处购买各种实现。

将零信任原则应用于高风险应用程序意味着不允许它们执行潜在恶意操作。这些操作与企业网络安全堆栈中可能拥有的四种类型工具的关系如下所示。应用程序控制分为预执行和后执行（也称作peri执行），因为很少有应用程序控制工具支持后执行，那些支持后执行的工具被认为太难使用。尽管如此，我们可以看到每种工具对高风险应用程序可能应用的零信任缓解措施。

涵盖/遗漏的零信任原则：
- 应用程序控制（预执行）
- 应用程序控制（后执行）
- 行为检测（EDR）
- 隔离

将文件下载到磁盘：否、是、否、是
启动/加载磁盘上的文件：是、否、可能、否
修改磁盘上已有的关键系统或应用程序文件：否、是、可能、是
读取/窃取操作系统或其他应用程序内存中的数据：否、否、可能、是
将恶意指令注入另一个应用程序的内存：否、否、可能、是
将恶意库加载到另一个应用程序的内存：是、否、可能、是
添加/修改注册表键：否、是、可能、是
启动并使用操作系统实用程序：是、否、可能、是
启动/使用无文件进程：否、是、可能、是
接收并执行来自远程对手的命令：否、否、可能、是
传输被盗数据：否、否、否、是

行为检测（也称作EDR）不是零信任机制。许多“可能”答案需要解释。一个AppJacking攻击可能涉及十个阶段。如果在第三阶段发生检测，并且该检测具有高统计置信度，那么行为检测代理将在一秒钟内终止攻击中识别的所有进程。这可能发生在第四到第六阶段之前，这意味着第七到第十阶段永远不会发生。预防第七到第十阶段可能相当于上表中会被阻止的一个或多个行。但这些都是反应而非零信任拒绝。行为检测代理不会明确阻止第七到第十行的动作。相反，终止相关进程会导致这些原本会发生的行为被终止。从默认拒绝的角度来看，行为检测不是零信任机制。零信任机制本质上是确定性的：允许/拒绝特定动作。

在端点内添加零信任到网络安全防御对于缓解AppJacking风险和降低劳动力成本至关重要。优秀的医疗保健包括预防措施，如疫苗以避免感染，以及早期检测方法以治疗疾病。企业的网络安全防御也是如此，两者结合更好。检测工具可以击败可识别的恶意软件攻击。零信任工具不是通过识别恶意软件，而是通过阻止其有害行为来击败攻击。一种工具可以阻止另一种工具错过的，或者比另一种工具更早地阻止。这是优秀的网络安全防御。

通过零信任工具阻止检测工具错过的内容，并在检测工具反应之前阻止一些可检测的攻击，添加一个在端点内应用零信任的工具可以减少网络安全堆栈中多个检测工具的警报数量，从而减轻相应网络安全团队的工作负担。此外，端点内的零信任控制在实时阻止攻击，这通常发生在端点被攻破之前。这样的工具可以在检测工具在端点被攻破后做出反应时减轻那些必须修复端点的人的工作负担。

隔离看起来很好但很少部署，因为大多数实现都非常痛苦。这个话题值得单独一篇博客文章。简而言之，有几种不同的隔离工具。主机沙箱不同于网络或云沙箱，它是一个垃圾场，几年前就被企业端点移除了。微软提供的“应用程序防护”采用了进程虚拟化。这要求修改应用程序源代码，以便应用程序能够穿透边界在整个端点上工作。很少有应用程序经过这样的修改。“应用程序防护”随Windows企业许可证免费提供，但不到1%的企业选择使用它。Bromium基于驱动的隔离工具也遭受了与主机沙箱相同的命运。几乎没有EPP包含隔离功能。必须从第三方获取这些功能。

AppGuard提供了企业所需以补充检测防御的零信任能力。AppGuard结合了“隔离”和“预执行应用程序控制”，相当于上表中总结的因AppJacking导致的有害操作的所有“是”条目，详细信息见底部表格。

与其他方案相比，AppGuard的操作工作量较小。AppGuard几乎不受过去和现在的应用程序控制或隔离工具的操作困难的影响。AppGuard确实需要一些前期调优，如果受保护主机进行了重大更改，有时后期也需要调优。在策略未强制执行的短暂发现阶段，可以看到一个或少数几个合法应用程序需要进行策略调优。在策略强制执行的第一周或两周内，可能还需要一些额外的调优。根据观察，部署代理中不到1%的策略与供应商指定的默认策略不同，这种调优工作量很小且很短暂。