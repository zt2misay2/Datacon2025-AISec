我们继续与当局和安全社区合作，进行技术分析以确定IOC并了解恶意软件在初始入侵后的行为。到目前为止，我们已经确认了以下行为：入侵载体使用了OpenSLP漏洞，可能是CVE-2021-21974（仍需进一步确认）。日志显示用户dcui参与了入侵过程。加密过程中，恶意软件部署了一个位于/tmp/public.pem中的公钥，并专门针对虚拟机文件（如.vmdk、.vmx等）进行加密。此外，恶意软件试图通过杀死VMX进程来关闭虚拟机以解锁文件，但此功能并不总是按预期工作，导致文件保持锁定状态。恶意软件还创建了一个argsfile，用于存储传递给加密二进制文件的参数（例如跳过的MB数、加密块中的MB数、文件大小）。没有证据表明数据外泄发生过。在某些情况下，文件加密可能部分失败，从而允许恢复数据。土耳其安全研究员Enes Sönmez (@enes_dev) 已经记录了一种VMDK文件恢复的方法，该方法在他的博客(https://enes.dev/) 中进行了描述。我们和其他安全专家测试了这一程序，在多个受影响的服务器上取得了约2/3的成功率。请注意，执行此程序需要较强的技术能力，自行承担风险，并建议寻求专家的帮助。
在之前的帖子版本中，我们曾假设这次攻击与Nevada勒索软件有关，这是一个错误。目前没有任何材料可以将这次攻击归因于任何特定团体。归因从来都不容易，我们让安全研究人员自己得出结论。ESXi操作系统只能安装在裸金属服务器上。为了识别客户的ESXi安装，我们启动了几项基于自动化日志的举措。由于我们无法逻辑访问客户的服务器，因此我们的行动手段有限。对于已识别的裸金属主机，我们在周五下午发送了电子邮件，警告客户潜在的风险并提供如何减轻风险的信息。同时，我们封锁了互联网与安装ESXi的服务器之间的OpenSLP端口（427）。如果出于某种原因需要使用427端口，客户可以在其管理界面中停用过滤规则。我们还启动了扫描，通过测试是否存在指定主机已被入侵的网页和/或ssh横幅来识别被入侵的主机，并通知受影响的客户。我们的支持团队全力动员，帮助客户保护他们的系统，并在他们受到攻击影响时协助恢复。

此次攻击主要针对7.0 U3i版本之前的ESXi服务器，显然通过OpenSLP端口（427）进行。要检查您的ESXi版本，请参阅您的客户界面上的服务器页面，或直接查看系统本身的ESXi界面。对于使用ESX-i的裸金属客户，我们强烈建议紧急采取以下措施：禁用服务器上的OpenSLP服务或将访问限制为仅受信任的IP地址 (https://kb.vmware.com/s/article/76372)，并将您的ESXi升级到最新的安全补丁。之后，确保您的数据已备份（最好是在不可变存储上），只有必要的服务处于活动状态，并通过ACL过滤仅允许受信任的IP地址访问。同时，监控您的系统是否有任何异常行为。使用VMware私有云的客户不受影响，因为设计上SSL网关会阻止外部访问此端口（OpenSLP 427）。对于我们的公共云客户，由于不依赖于ESXi，因此没有发现风险。OVHcloud产品组合中的其他产品也不受此次勒索软件活动的威胁。
目前有一波攻击正在针对ESXi服务器。虽然没有OVHcloud管理的服务受到此次攻击的影响，但许多客户在自己的服务器上使用这个操作系统。因此，我们提供这篇帖子作为参考，以帮助他们进行修复。这些攻击在全球范围内被检测到。根据生态系统中的专家以及权威机构的说法，恶意软件可能利用了CVE-2021-21974作为入侵载体。调查仍在进行中，以确认这些假设。我们的技术团队正在努力识别攻击的详细特征，并与来自其他CERT和安全团队的同行协调。

更新 07/02/2023
我们继续进行调查并为客户提供支持。我们优先考虑以下工作：识别我们网络中受影响的客户，以提供最准确和适当的信息，帮助他们从攻击中恢复；识别潜在的脆弱客户，确保他们在类似攻击再次发生时尽快采取适当的措施来减轻风险。一些安全研究人员可能已经发现了Babuk勒索软件源代码（于2021年9月泄露）之间的联系。加密算法（Sosemanuk）在这两种情况下都被使用，但代码结构似乎略有不同。

除了之前描述的恢复程序外，我们注意到加密过程只影响文件中的一小部分数据。根据您的虚拟机操作系统和文件系统类型，您可能能够使用数据恢复工具至少部分地恢复数据。请注意，这些工具可能会对文件产生不可逆的影响，因此我们建议在尝试任何恢复操作之前将虚拟机文件复制到另一个位置以保护数据。我们列出了可以协助您恢复数据和重建系统的公司名单。该名单将在OVHcloud支持页面上提供。

我们也提醒作为数据控制者的客户，他们在发生安全事件时可能有法律要求通知当局。确保您在规定的时间内向适当的当局申报了事件。您可以在下面找到主要受影响国家的数据保护当局关于数据泄露违规的程序以及CERT网站。请与您的法律部门或法律顾问确认，以确保根据您的身份通知正确的组织。对于个人数据控制者：

法国：
https://www.cnil.fr/fr/notifier-une-violation-de-donnees-personnelles

意大利：
https://servizi.gpdp.it/databreach/s/

比利时：
https://www.autoriteprotectiondonnees.be/professionnel/actions/fuites-de-donnees-personnelles

西班牙：
https://www.aepd.es/es/derechos-y-deberes/cumple-tus-deberes/medidas-de-cumplimiento/brechas-de-datos-personales-notificacion

波兰：
https://uodo.gov.pl/pl/501/2278

英国：
https://ico.org.uk/for-organisations/report-a-breach/

德国：
https://formulare.bfdi.bund.de/lip/form/display.do?%24context=E72B6A6366642AE42118

葡萄牙：
https://www.cnpd.pt/databreach/

魁北克：
https://www.cai.gouv.qc.ca/incident-de-confidentialite-impliquant-des-renseignements-personnels/aviser-commission-et-personnes/

CERT：

法国：
https://www.cert.ssi.gouv.fr/les-bons-reflexes-en-cas-dintrusion-sur-un-systeme-dinformation/

意大利：
https://cert-agid.gov.it/contatti/

比利时：
https://www.cert.be/fr/signaler-un-incident

西班牙：
https://www.ccn-cert.cni.es/gestion-de-incidentes/notificacion-de-incidentes.html

波兰：
https://incydent.cert.pl/#!/lang=en

英国：
https://report.ncsc.gov.uk/

加拿大：
https://www.cyber.gc.ca/en/incident-management

德国：
https://www.bsi.bund.de/DE/Themen/Unternehmen-und-Organisationen/Cyber-Sicherheitslage/Reaktion/CERT-Bund/Kontakt/kontakt_node.html

葡萄牙：
https://www.cncs.gov.pt/pt/certpt/

附加参考资料：
https://www.bleepingcomputer.com/news/security/
https://www.bleepingcomputer.com/forums/t/782193/esxi-ransomware-help-and-support-topic-esxiargs-args-extension/massive-esxiargs-ransomware-attack-targets-vmware-esxi-servers-worldwide/
https://blogs.vmware.com/security/2023/02/83330.html
https://members.loria.fr/MMinier/static/papers/sosemanuk_8.pdf
2023年7月24日，AMD发布了一份安全公告，披露了其Zen2计算机处理器微架构中的一个漏洞。该漏洞被AMD命名为“跨进程信息泄露”，也被称为“Zenbleed”。该漏洞被标记为CVE-2023-20593，并被AMD评为中等严重程度。此问题允许攻击者在特定情况下访问CPU处理的敏感信息。所有运行在基于AMD Zen2处理器上的软件，包括虚拟机、沙箱、容器和进程，都会受到影响。利用此漏洞的软件可能已经存在，预计基于此漏洞的攻击很快就会发生。

所有AMD Zen2 CPU，包括EPYC Rome处理器，都存在此漏洞，具体包括：
- AMD Ryzen 3000系列处理器
- AMD Ryzen PRO 3000系列处理器
- AMD Ryzen Threadripper 3000系列处理器
- 带有Radeon显卡的AMD Ryzen 4000系列处理器
- 带有Radeon显卡的AMD Ryzen PRO 4000系列处理器
- 带有Radeon显卡的AMD Ryzen 5000系列处理器
- 带有Radeon显卡的AMD Ryzen 7020系列处理器
- 第二代AMD EPYC “Rome”处理器

对OVHcloud产品的影响
针对这一事件，我们立即审查了安全公告和技术信息，并确定了以下对我们产品可能产生的影响。
- 公共云：所有产品未受影响
- 托管私有云：所有产品未受影响
- 网站托管与域名：所有产品未受影响
- 裸机云：ADVANCE-1, Advance STOR-1, Advance STOR-2, Game-1, Game-2, HGR-SDS-2, HGR-HCI-4, HGR-HCI-5, HGR-HCI-6, Infra-2, Rise-GAME-1, Rise-GAME-2, Scale-1, Scale-2, Scale-3（仅限由AMD Zen2驱动的服务器）可能受影响
- 其他商用系列专用服务器：未受影响

如何缓解漏洞：
- 客户自行缓解：通过固件包更新在启动时加载修补的微代码。此解决方案将通过操作系统更新（例如linux-firmware包）触发处理器微代码的更新。您可以在您的操作系统编辑器或社区分发更新包后进行操作。此方法取决于您的发行版或操作系统编辑器，并且只有在AMD提供了适当的微代码时才有效。目前，只有“Zen2 Rome”和“Zen2 Castle Peak”可以通过此方法覆盖。
- 使用更新的内核缓解：当无法通过固件更新包获得微代码更新时，您可以更新内核版本，通过配置所谓的“chicken bit”来禁用故障处理器功能以实现缓解。这可能会影响系统的性能。此解决方案将在操作系统编辑器回传新版本的Linux内核时包含。我们建议客户优先采用此缓解策略，因为这是最有效的，不依赖于硬件供应商是否提供更新的微代码。
- 作为替代方案，您可以手动设置chicken bit而不依赖内核更新。然而，我们不推荐这种可能对系统有风险的解决方案。

OVHcloud发起的缓解措施
OVHcloud团队正在努力实施透明的解决方案，确保客户的修补微代码以透明的方式更新。这些解决方案将逐步部署到我们的服务器上。目前正在评估两个主要选项。
- 使用OVHcloud iPXE：当客户使用标准的OVHcloud网络启动（最常见的配置）时，引导加载程序可能会加载微代码更新。一旦可用，通过OVHcloud客户界面重启服务器将导致在从磁盘启动之前加载更新的微代码，从而缓解漏洞。但是，如果您不使用OVHcloud网络启动系统直接从磁盘启动，则不会应用缓解措施，您应该考虑依赖操作系统级别的缓解措施。
- 使用UEFI：UEFI固件更新可能在启动时更新CPU微代码。包括修补微代码的UEFI固件更新可能会在未来几个月内由主板制造商提供。一旦可用，OVHcloud将在任何新交付的服务器上包含此修补微代码。客户随后可以通过联系支持请求UEFI固件更新。

作为潜在受影响服务器的管理员，我该怎么办？
首先，使用我们团队开发的工具（仅限Linux）检查您的服务器是否受到此漏洞的影响：
# wget https://raw.githubusercontent.com/speed47/spectre-meltdown-checker/master/spectre-meltdown-checker.sh
# sh spectre-meltdown-checker.sh --variant zenbleed --explain
如果工具显示“NOT VULNERABLE”（未受影响），则您已经安全，无需进一步行动。
如果工具显示“VULNERABLE”（受影响），则应评估您面临威胁的程度。